<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta content="telephone=no" name="format-detection" />
    <meta name="baidu-site-verification" content="nD6yyolNXN" />
	<title>东钩教主刘二龙狼人杀露脸羞耻开黑</title>
	<script src="/jquery.js"></script>		
	<script src="/activity/build/mediaelement-and-player.min.js"></script>
	<script src="/jquery.sha1.js"></script>
	<script src="/wxjsapi.js"></script>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<link rel="stylesheet" href="/activity/build/mediaelementplayer.min.css" />
	<link rel="stylesheet" href="/css/share.css" />
	<style>
		html{width:100%; height:100%; -webkit-tap-highlight-color:transparent;}
		*{margin: 0; padding: 0;}
		body{font-family:Hiragino Sans GB W3,'微软雅黑',Heiti SC; 
			font-size:62.5%; 
			font-style:normal; 
			max-width: 800px; 
			margin:0 auto; 
			height:100%; 
			color:#9da4ad;
			background: #141a20; 
			overflow-x:hidden; 
			-webkit-overflow-scrolling:touch;
		}
		img{border:0; max-width:100%;}
		body{
			background: #fff;
		}
		img{
			vertical-align: top;
			width: 100%;
		}
		img.m-gb{
			position:relative;
		}
		img.m-f{
			position:absolute;
			display:inline-block;
			width:30%;
			top:22.5%;
			left:10%;
		}
		img.m-f-game{
			margin-left:50%;
		}
		img.m-f-arrow{
			width:20%;
			left:40%;
			top:24%;
			animation:myfirst 1s;
			animation-iteration-count:infinite;
		}
		@keyframes myfirst
		{
		from {top:24%;}
		to {top:24.3%;}
		}
		img.m-f-signup{
			left:35%;
			top:96.5%;
		}
		.m-chat{
			position:absolute;
			width:92%;
			top:17.6%;
			height: 6.5rem;
			margin:0% 4%;
			/*border:1px solid #ff0;*/
			font-size:12px;
			color:#f3f3f3;
			overflow: auto;
		}
		img.m-c{
			display:inline-block;
			width:3%;
			vertical-align: middle;
		}
		img.m-c-r{
			display:inline-block;
			width:10%;
		}
		.g-convedio{
			position:relative;
			width:100%;
		}
		.g-convedio .videoBox{
			position:absolute;
			top:35.2%;
			width:100%; 
			z-index:888;
		}
		.g-bofingers{
			left:6%;
			top:35%;
			z-index:888;
			overflow:hidden;
		}
		.g-fingers{
			position: absolute;
			width:25%;
			left:3%;
			float:left;
			top:37%;
			z-index:9999;
		}
		.g-buttons{
			position: absolute;
			width:75%;
			left:18%;
			top:22%;
			z-index:999;
			background:transparent;
		}
		.videoBox .mask,.videoBox .end-mask{
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0,0,0,0.8);
			/*border:1px solid ;*/
		}
		.videoBox .mask{
			display: none;
		}
		.videoBox .mask h3,.videoBox .end-mask h3{
			font-size: 14px;
			color: #fff;
			text-align: center;
			margin-top: 18%;
		}
		.btn-group{
			width: 70%;
			margin:0 auto;
		}
		.btn-group a{
			text-decoration: none;
			display: inline-block;
			width: 45%;
			height: 30px;
			line-height: 28px;
			background: rgba(255,51,102,0.1);
			border:1px solid #f36;
			border-radius: 6px;
			color:#fff;
			text-align: center;
			font-size: 12px;
			box-sizing: border-box;
			margin-top: 8%;
			border-color:#5885dd;
		}
		.btn-group .return{
			margin-left: 10%;
		}
		.single a{
			display: block;
			margin: 8% auto 0;
		}

	</style>
	<script>
		var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?5f199d5d81411ab659081729f1f34008";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
		enableWxShare({
			appId: 'wxf96f728533f32fa8',
			ticket: '{{ticket}}',
			title: '东钩教主刘二龙狼人杀露脸羞耻开黑',		
			imgUrl: 'http://img.wangyuhudong.com/uploads/imgs/live/2017/03/17/89e9652c3a0a4ab0913af581d5c6a62a.jpg',
			desc: '想亲身体验教主我的实力么，戳进来你就有机会和我一起玩！'
		})
	</script>
</head>
<body>
	<div class="g-container">
		<div class="g-convedio">
			<img src="/activity/images/w-bg-1.jpg" class="m-bg">
			<img src="/activity/images/w-bg-11.jpg" class="m-bg">
			<img src="/activity/images/w-bg-2.jpg" class="m-bg">
			<img src="/activity/images/w-bg-3.jpg" class="m-bg">
			<img src="/activity/images/w-bg-4.jpg" class="m-bg">
			<div class="videoBox">
				{% if one.state==1 %}
                    <video width="100%" height="100%" id="player1" poster="{{result.info.icon}}" controls="" autoplay="" webkit-playsinline playsinline style="margin:0;border:0;"><source type="application/x-mpegURL" src="{{link}}" /></video>
					<div class="mask">
						<h3>下载娱儿直播观看更多精彩直播</h3>
						<div class="btn-group">
							<a href="https://yuertvfile.wangyuhudong.com?type=live&objId=8549" class="enter">下载娱儿直播</a><a href="" class="return">继续观看</a>
						</div>				
					</div>
				{% else %}
                    <div class="end-mask">
						<h3>直播尚未开始</h3>
						<div class="btn-group single">
							<a href="https://yuertvfile.wangyuhudong.com?type=live&objId=8549">下载娱儿直播</a>
						</div>				
					</div>
                {% endif %}		
			</div>
			<div class="m-chat" id="chat"></div>
			<img src="/activity/images/w-interactive.png" class="m-f" id="inter">
			<img src="/activity/images/w-game.png" class="m-f m-f-game" id="game">
			<img src="/activity/images/w-arrow.png" class="m-f m-f-arrow" id="arrow">
			<img src="/activity/images/w-signup.png" class="m-f m-f-signup" id="signup">
		</div>
	</div>
	<script src="/sha1.js"></script>
	<script src="/Web_SDK_Base_v2.8.0.js"></script>
	<script src="/Web_SDK_Chatroom_v2.8.0.js"></script>
	<script>
		$('video').mediaelementplayer({
			features: ['playpause','volume','fullscreen'],
		});
		var client = $(window).width();
		$('.videoBox').css('height',client*0.55+'px');
		// 三个按钮的跳转
		$("#inter").on("click",function(){
			$.ajax({
                method: "GET",
                url: "/api/countKillingWerewolfPlus",
                dataType: 'json',
                success: function(data) {
                    
                },
                error: function(a, b, c) {
                    console.log("接口出问题啦");
                }
	        })
			window.location.href="http://yuerapi.wangyuhudong.com/v4/live/download?from=singlemessage&isappinstalled=0";
		})
		$("#game").on("click",function(){
			window.location.href="/activity/wolfmiddle"; 
		})
		$("#signup").on("click",function(){
			window.location.href="http://qm.qq.com/cgi-bin/qm/qr?k=dMNhuGq5f2LUA-_IQ5qKIaHDn81Rc9Yi";
		})
		var ua = navigator.userAgent.toLowerCase(); 
		if(ua.match(/YuertvBrowser/i)=="yuertvbrowser"){
			$('.mask h3').text('进入直播间观看直播');
			$('.enter').text('进入直播间');
			$('.enter').attr('href','yuertvopen://live?objId=8549');
		}
		function rotate(){ 
		  	if(window.orientation==180||window.orientation==0){ 
		  		var screenw = (ua.match(/QQ/i)=="qq" && ua.match(/android/i)) ? screen.width :document.body.clientWidth;
		    	$('.videoBox').css({'height':screenw*0.55+'px','top':screenw*0.565+'px'});
		    	$('video').css('height',screenw*0.55+'px');
		  	} 
			if(window.orientation==90||window.orientation==-90){ 
				var screenw = (ua.match(/QQ/i)=="qq" && ua.match(/android/i)) ? screen.width :document.body.clientWidth;
		        $('.videoBox').css({'height':screenw*0.55+'px','top':screenw*0.565+'px'});
		        $('video').css('height',screenw*0.55+'px');
		    } 
		} 
		rotate();
		window.addEventListener("onorientationchange" in window ? "orientationchange" : "resize", rotate, false); 
		var second = 0;
		function showMask(val) { 
            if (second < 180) { 
                second++;
                setTimeout(function() { 
	                showMask(val);
	            },1000);
            } else {
                $('.mask').show();                   
            }
        }
		if('{{state}}'==1){
        	showMask(second); 
        }
        $('.return').click(function(e){
        	e.preventDefault();
        	$('.mask').hide();
        	second = 0;
        	showMask(second); 
        })

		var lct = document.getElementById('chat');

		var live_account = "",
		    live_token = "";

		$.ajax({
		    method: "GET",
		    url: "/api/visitor",
		    dataType: 'json',
		    success: function(data) {
		        if (data.code == 0) {
		            live_account = data.object.accid;
		            live_token = data.object.token;
		            enterLiveroom();
		        }else{
		            console.log(data.result);
		        }
		    },
		    error: function(a, b, c) {
		        console.log("接口出问题啦");
		    }
		}); 

		function enterLiveroom(){
			// 聊天室服务器地址
			var address=[];
			// 当前时间
			var myDate = new Date(),
				y = myDate.getFullYear(),   //获取完整的年份(4位,1970-????)
				m = myDate.getMonth()+1,      //获取当前月份(0-11,0代表1月)
				d = myDate.getDate(),       //获取当前日(1-31)
				h = myDate.getHours(),      //获取当前小时数(0-23)
				mi = myDate.getMinutes(),    //获取当前分钟数(0-59)
				s = myDate.getSeconds();   //获取当前秒数(0-59)
			var CurTime = Date.UTC(y,m,d,h,mi,s);
			var roomid = parseInt(4174310);
			var shaObj = new jsSHA("SHA-1", "TEXT");
			// AppSecret
			shaObj.update('1981023862be'+1+CurTime);
			var hash = shaObj.getHash("HEX");

			// 获取聊天室信息重要参数
			var appKey = '5585496885932f31d478ed0222072bcf',
				roomid = '{{result.info.chat_room_id}}',
				accid = '{{result.info.up_user_id}}';

			$.ajax({
			    url: "https://api.netease.im/nimserver/chatroom/requestAddr.action",
			    contentType:"application/x-www-form-urlencoded;charset=utf-8",
			    type: 'POST',
			    beforeSend: function (req) {
			        req.setRequestHeader('appkey', appKey);
			        req.setRequestHeader('Nonce',1);
			        req.setRequestHeader('CurTime',CurTime);
			        req.setRequestHeader('CheckSum',hash);
			    },
			    data:{roomid:roomid,accid:accid}
			}).done(function(data) {
			    if(data.code===200){
			       address = data.addr;
			       getChat();
			    }else{
			        alert("获取连接房间地址失败");
			    }   
			})
			function getChat(){
				var chatroom = Chatroom.getInstance({
				    appKey: appKey,
				    account: live_account,
				    token: live_token,
				    chatroomId: roomid,
				    chatroomAddresses: address,
			        onconnect: onChatroomConnect,
				    onerror: onChatroomError,
				    onwillreconnect: onChatroomWillReconnect,
				    ondisconnect: onChatroomDisconnect,
				    // 消息
				    onmsgs: onChatroomMsgs
				});
			}


			function onChatroomConnect(chatroom) {
			    console.log('进入聊天室', chatroom);
			    $('#chat').append("<div><img src='/activity/images/w-c-a.png' class='m-c'> 欢迎来到 {{result.info.nickname}} 的直播间,喜欢主播的别忘点关注哦！<div>"); 
			}
			function onChatroomWillReconnect(obj) {
			    // 此时说明 `SDK` 已经断开连接, 请开发者在界面上提示用户连接已断开, 而且正在重新建立连接
			    console.log('即将重连', obj);
			}
			function onChatroomDisconnect(error) {
			    // 此时说明 `SDK` 处于断开状态, 开发者此时应该根据错误码提示相应的错误信息, 并且跳转到登录页面
			    console.log('连接断开', error);
			    if (error) {
			        switch (error.code) {
			        // 账号或者密码错误, 请跳转到登录页面并提示错误
			        case 302:
			            break;
			        // 被踢, 请提示错误后跳转到登录页面
			        case 'kicked':
			            break;
			        default:
			            break;
			        }
			    }
			    $('#chat').append("<div>连接断开<div>"); 
			}
			function onChatroomError(error, obj) {
			    console.log('发生错误', error, obj);
			}
			function onChatroomMsgs(msgs) {
			    console.log('收到聊天室消息', msgs);
			    // $('.chat').html(msgs)
			    for(var i=0;i<msgs.length;i++){
			    	if(msgs[i].content){
			    		var content=JSON.parse(msgs[i].content);
			    		// console.log(content);
			    		if(content.data.giftNum>1){
			    			$('#chat').append("<div class='gift'>"+content.data.senderName+":&nbsp;&nbsp;送给主播1个"+content.data.giftName+"<span class='combo'>"+content.data.giftNum+"<i></i></span><div>");
			    		}else{
			    			$('#chat').append("<div class='gift'>"+content.data.senderName+":&nbsp;&nbsp;送给主播1个"+content.data.giftName+"<div>");
			    		}
			    	}else if(msgs[i].text && msgs[i].fromNick){
			    		var host = msgs[i].fromNick=="1" ? '<label for="">主播</label>&nbsp;' : '';
						$('#chat').append("<div>"+host+"<span class='fromNick'>"+msgs[i].fromNick+":&nbsp;&nbsp;</span>"+msgs[i].text+"<div>");   		
			    	}else if(msgs[i].text && !msgs[i].fromNick && msgs[i].custom){
			            var custom=JSON.parse(msgs[i].custom);
			            $('#chat').append("<div><span class='fromNick'>"+custom.nickname+":&nbsp;&nbsp;</span>"+msgs[i].text+"</div>");        
			        }else if(msgs[i].flow=="in" && !msgs[i].text && msgs[i].attach.fromNick && msgs[i].attach.type=="memberEnter"){
			    		$('#chat').append("<div>欢迎用户"+msgs[i].attach.fromNick+"进入直播间");
			    	}else if(msgs[i].flow=="in" && msgs[i].text && msgs[i].custom =="" ){
			            $('#chat').append('<div>'+msgs[i].text+'</div>');
			        }
			    	lct.scrollTop=Math.max(0,lct.scrollHeight-lct.offsetHeight);    	
			    }
			}
		}
	</script>
</body>
</html>