<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width,initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta content="telephone=no" name="format-detection" />
    <link rel="shortcut icon" type="image/ico" href="/yuer.ico">
	<title>个人中心</title>
	<style type="text/css">
		html{width:100%; height:100%; -webkit-tap-highlight-color:transparent;}
		body,ul,li,p,h3,h4,h2,em,button,input{margin: 0; padding: 0;}
		body{font-family:Hiragino Sans GB W3,'微软雅黑',Heiti SC; 
			font-size:62.5%; font-style:normal;  margin:0 auto; height:100%; color:#9da4ad; 
			background: #f0f6ff; overflow-x:hidden; -webkit-overflow-scrolling:touch;max-width:800px;}
		img{border:0; max-width:100%;vertical-align: top;}
		[v-cloak] { display: none }
		img.m-bg{
			position:relative;
		}
		.g-m{
			position:absolute;
			width:94%;
			margin:0% 3%;
			background:#fff;
			border-radius:5px;
		}
		/*如何提现*/
		.m-main{
			height:25%;
			margin-top:5%;
			top:5%;
		}
		.m-m-icon{
			display:block;
			width:50px;
			height:50px;
			position:absolute;
			top:-20%;
			left:45%;
			border-radius:50px;
		}
		.m-m-withdrawal{
			display:block;
			width:30%;
			height:20px;
			line-height:20px;
			background:#00acff;
			text-align:center;
			border-radius:20px;
			font-size:16px;
			color:#fff;
			margin:10% auto 6%;
		}
		.m-mtr{
			overflow:hidden;
			width:88%;
			margin:2% 5% 4% 8.55%;
			margin-top:1.5rem;
		}
		.u-mtr{
			float:left;
			width:30%;
			font-size:13px;

			color:#98a5b3;
		}
		.u-mtr-s,.u-mtr-t,.u-mtr-m{
			display:block;
			margin-left:25%;
			font-size:18px;line-height:1.2;
			color:#647580;
		}
		.m-mtr-t{
			margin-left:3.3%;
		}
		.m-mtr-m{
			margin-left:6.7%;
		}
		/*直播时长*/
		.m-time{
			top:34%;
			margin-top:2%;
			padding-bottom:0.5rem;
		}
		.m-t-e,.m-t-l,.m-r-live,.m-r-tc,.m-r-empty{
			width:92%;
			margin:2% auto 0;
			font-size:18px;
			color:#647580;
		}
		.m-t-e span{
			font-size:12px;
		}
		/*柱形图*/
		div.m-t-l{overflow:hidden;}
		.m-tl{float:left;}
		.m-tl-left{width:5%;}
		.u-tl{display:block;margin:13.5px 2px 0px 0%;font-size:12px;height:12px;color:#647580;}
		.u-tl-lb{margin-bottom:0%;}
		.m-tl-right{float:left;width:90%;/*height:161px;line-height:161px;*/margin-top:5.5%;/*margin-bottom:2%;*/position:relative;left:20px;}
		.m-tl-bottom{width:90%; margin-left:6%;font-size:12px;color:#647580;}
		.m-tl-bottom span{display:inline-block;width:10%;margin:1% 2%;}
		.u-tl-bar{display:inline-block;vertical-align:bottom;width:10px;border-radius:5px;background:linear-gradient(#03b5ff,#a2e3ff);margin:0 5.5%;}
		.hrs{position:relative;display:inline-block;width:36px;left:-10px;top:-26.5px;font-size:10px;color:#fff;background:url(/cash/images/bg-r.png) no-repeat;background-size:contain;line-height:2;text-align:center;}
		/*直播纪录*/
		.m-record{
			margin-top:65%;
			padding-bottom:1rem;
		}
		.m-r-tc{
			overflow:hidden;
			margin:5%;
		}
		.m-rt{
			float:left;
		}
		.m-rt-date{width:20%;height:2.3rem;}
		.m-rt-d{
			font-size:24px;
			color:#333;
			font-weight:bold;
		}
		.u-rt-spec{
			font-weight:normal;
			font-size:12px;
			margin-left:-2.79%;
		}
		.m-rt-title{
			position:relative;
			width:70%;
			height:20px;
			line-height:20px;
			background:#f0f6ff;
			font-size:13px;
			color:#647580;
			margin-top:5px;
			/*left:25%;*/
			white-space:nowrap;/* 不换行 */
			overflow:hidden;/* 内容超出宽度时隐藏超出部分的内容 */
			text-overflow:ellipsis;/* 当对象内文本溢出时显示省略标记(...) ；需与overflow:hidden;一起使用。*/ 
			float: left;
		}
		.u-rtt{
			display:inline-block;
			margin:0 3.5%;
		}
		.showmore{width:50%;margin:5% auto;font-size:14px;color:#98a5b3;text-align:center;}
		/*为空状态*/
		.m-re-img{
			display:block;
			width:70px;
			height:100px;
			margin:10% auto 5%;
		}
		.m-re-i{
			font-size:13px;
			margin:0 11.5% 5%;
		}
		.f-cb{overflow:hidden;}
	</style>
</head>
<body>
<div class="g-con" id="pvue" v-cloak>
	<img src="/cash/images/pc-bg.jpg" class="m-bg">
	<div class="m-main g-m">
		{% if livenum.upInfo.icon %}
          <img src="{{livenum.upInfo.icon}}" alt="" class="m-m-icon">
        {% else %}
          <img src="/cash/images/default_avatar.png" class="m-m-icon">
        {% endif %}
		<span class="m-m-withdrawal">如何提现</span>
		<div class="m-mtr">
			<div class="m-mtr-s u-mtr">
			{% if livenum.upInfo.liveNum=="" %}
			<span class="u-mtr-s">0</span>
			{% else %}
			<span class="u-mtr-s">{{livenum.upInfo.liveNum}}</span>
			{% endif %}
			直播场次(场)</div>
			<div class="m-mtr-t u-mtr">
			{% if livenum.upInfo.time=="" %}
			<span class="u-mtr-t">0</span>
			{% else %}
			<span class="u-mtr-t">{{livenum.upInfo.time}}</span>
			{% endif %}
			直播时长(小时)</div>
			<div class="m-mtr-m u-mtr">
			{% if livenum.upInfo.total_amount=="" %}
			<span class="u-mtr-m">0</span>
			{% else %}
			<span class="u-mtr-m">{{livenum.upInfo.total_amount}}</span>
			{% endif %}
			我的收益(元)</div>
		</div>
	</div>
	<div class="m-time g-m">
		<p class="m-t-e">每日直播时长<span>(有效)</span></p>
		<div class="m-t-l">
			<div class="m-t-line f-cb" style="position:relative;height:180px;">
				{% if livenum.sevenLiveInfo!="" %}
				<div class="m-tl-left m-tl" style="position:absolute;bottom:1px;">
					<span class="" v-if="formatTime(slitime,4)<=5" >
						<span class="u-tl" v-for="n in 6">${6-n}h</span>
					</span>
					<span class="" v-else-if="5<formatTime(slitime,4) && formatTime(slitime,4)<=10">
						<span class="u-tl" v-for="n in 6" >${(6-n)*2}h</span>
					</span>
					<span class="" v-else="10<formatTime(slitime,4) && formatTime(slitime,4)<=15">
						<span class="u-tl" v-for="n in 6">${(6-n)*3}h</span>
					</span>
				</div>
				{% else %}
				<div class="m-tl-left m-tl">
						<span class="u-tl" v-for="n in 6">${6-n}h</span>
				</div>
				{% endif %}
				<div class="m-tl-right m-tl" style="position:absolute;bottom:0;">
				{% if livenum.sevenLiveInfo.time!=0 %}
					<div class="u-tl-bar" id="ms" v-for="(sli,index) in sevenLiveInfo" v-if="formatTime(sli.time,4)<=5" :style={height:formatTime(sli.time,3)+"px"}><span id="#hrs" class="hrs">${formatTime(sli.time,4)}h</span></div>
					<div class="u-tl-bar" id="ms" v-for="(sli,index) in sevenLiveInfo" v-else-if="5<formatTime(slitime,4) && formatTime(slitime,4)<=10" :style={height:formatTime(sli.time,5)+"px"}><span id="#hrs" class="hrs">${formatTime(sli.time,4)}h</span></div>
					<div class="u-tl-bar" id="ms" v-for="(sli,index) in sevenLiveInfo" v-else="10<formatTime(slitime,4) && formatTime(slitime,4)<=15" :style={height:formatTime(sli.time,6)+"px"}><span id="#hrs" class="hrs">${formatTime(sli.time,4)}h</span></div>
				{% else %}
					<div class="u-tl-bar" id="ms" v-for="(sli,index) in sevenLiveInfo" :style={height:formatTime(sli.time,3)+"px"}><span id="#hrs" class="hrs">0h</span></div>
				{% endif %}
				</div>
			</div>
			<hr style="display:block;width:100%;border:1px solid #e3e3e3;margin-top:1rem;">
			<div class="m-tl-bottom" ><span v-for="(lr,index) in sevenLiveInfo">${formatTime(lr.date,2)}</span></div>
		</div>
	</div>
	<div class="m-record g-m">
		<p class="m-r-live">直播记录</p>
		{% if livenum.liveRecord!="" %}
		<div class="m-r-tc" v-for="(item,index) in liveRecord">
			<p class="m-rt-date m-rt"><span class="m-rt-d"  v-show="item.date!=null">${formatTime(item.date,1)}</span>
				<span class="u-rt-spec" v-show="item.date!=null">${formatTime(item.date,0)}<span>月</span></span>
			</p>
			<p class="m-rt-title m-rt">
				<span class="u-rtt">${item.duration}</span>${item.title}
			</p>
		</div>
		<div class="showmore" v-if="datatime.liveRecord==''">没有更多</div>
		<div style="width:50%;margin:5% auto;font-size:14px;color:#98a5b3;text-align:center;" @click="pageList()"   v-else>加载更多</div>
		{% else %}
		<div class="m-r-empty">
			<img src="/cash/images/pc-empty.jpg" class="m-re-img">
			<p class="m-re-i">您还没有产生有效直播记录，快去直播吧！</p>
		{% endif %}
		</div>
	</div>
</div>
<script type="text/javascript" src="/jquery.min.js"></script>
<script src="/vue.js"></script>
<script type="text/javascript">
var pvue = new Vue({
        el: '#pvue',
        delimiters: ['${', '}'],
        data: {
            datatime:[],
            liveRecord:[],
            sevenLiveInfo:[],
            upInfo:[],
            date:0,
            Y:0,
            m:0,
            d:0,
            H:0,
            i:0,
            s:0,
            rs:0,
            value:0,
            lrdate:0,
            lrduration:0,
            slidate:0,
            page:1,
            userId:"",
            token:"",
            slitime:0,
        },
        computed: {
		    mylivefilter: function () {
		      return this.formatTime(this.lrdate)
		    },
		    myliveRfilter: function () {
		      return this.formatTime(this.lrduration)
		    },
		    mysevenfilter: function () {
		      return this.formatTime(this.slidate)
		    },
		},
        mounted: function () {
            this.$nextTick(function () {
                this.userId = this.getQueryString("userId");
                this.token = this.getQueryString("token");
                this.newsList();
                var ua = navigator.userAgent.toLowerCase(); 
				if(ua.match(/YuertvBrowser/i)=="yuertvbrowser"){

				}else{

					window.location.href = "/cash/signup";
				}
            })
        },
        methods:{
	        formatTime:function (value,type) {
			    date = new Date(value);
				m = date.getMonth() + 1,
				d = date.getDate(),
				H = date.getHours(),
				i = date.getMinutes(),
				s = date.getSeconds();
				rs = Math.round((value/3600)*10)/10
				if (m < 10) {
					m = '0' + m;
				}
				if (d < 10) {
					d = '0' + d;
				}
				if (i < 10) {
					i = '0' + i;
				}
				if (s < 10) {
					s = '0' + s;
				}
				if(type==0){
					return m
				}else if(type==1){
					return d 
				}else if(type==2){
					return m+"/"+d
				}else if(type==3){
					return rs*27.8
				}else if(type==4){
					return rs
				}else if(type==5){
					return rs*13.9
				}else if(type==6){
					return rs*9.267
				}else if(type==7){
					return H
				}
			},
			getQueryString:function (name) {
			    var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
			    var r = window.location.search.substr(1).match(reg);
			    if (r != null) {
			        return unescape(r[2]);
			    }
			    return null;
			},
	        newsList:function(){
	        	var _this = this;
		            $.ajax({
		                method: "GET",
		                url:"/api/withdraw/personalCenter",
		                dataType: 'json',
		                data:{
		                	userId:_this.userId,
		                	token:_this.token
		                },
		                success: function(data) {
		                    if (data.code == 0) {
		                           _this.datatime=data.object;
		                           // 页面第三块：直播记录
		                           _this.liveRecord=data.object.liveRecord;
		                           // 页面第二块：七日直播时长
		                           _this.sevenLiveInfo=data.object.sevenLiveInfo;
		                           _this.upInfo=data.object.upInfo;
		                           // 页面第三块：直播记录－－日期
		                           _this.lrdate=data.object.liveRecord[0].date;
		                           // 页面第三块：直播记录－－持续时间
		                           _this.lrduration=data.object.liveRecord[0].duration;
		                           // 页面第二块：七日直播时长日期
		                           _this.slidate=data.object.sevenLiveInfo[0].date;   
		                           _this.slitime=data.object.sevenLiveInfo[0].time;  
		                           console.log(data.object.sevenLiveInfo[0].time);
		                    } else {
		                        console.log(data.result);
		                    }
		                },
		                error: function(a, b, c) {
		                    console.log("接口出问题啦");
		                }
		            })
	        },
	        pageList:function(page){
	        	var _this = this;
	        	_this.page+=1;
	            $.ajax({
	                method: "GET",
	                url:"/api/withdraw/liveRecord?userId="+_this.userId+"&token="+_this.token,
	                dataType: 'json',
	                data:{
	                	page:_this.page
	                },
	                success: function(data) {
	                    if (data.code == 0) {
	                          _this.datatime=data.object;
	                          console.log(data.object);
	                           // 页面第三块：直播记录
	                           // _this.liveRecord=data.object.liveRecord;
	                           console.log(data.object.liveRecord);
	                           // 页面第三块：直播记录－－日期
	                           _this.lrdate=data.object.liveRecord[0].date;
	                           // 页面第三块：直播记录－－持续时间
	                           _this.lrduration=data.object.liveRecord[0].duration;
	                           // _this.newsList();    
	                           _this.liveRecord=_this.liveRecord.concat(data.object.liveRecord);
	                           console.log(data.object.liveRecord);
	                    } else {
	                        console.log(data.result);
	                    }
	                },
	                error: function(a, b, c) {
	                    console.log("接口出问题啦");
	                }
	            })
	        }
        }
    })
	
</script>
</body>
</html>